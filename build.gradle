/*
 * user guide available at https://docs.gradle.org/4.3.1/userguide/tutorial_java_projects.html
 */
apply plugin: 'java'

defaultTasks 'clean', 'setProperties'

sourceSets {
    test.java.srcDir "src/test"
}

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.junit:junit5-engine:5.0.0-ALPHA'
    testCompile 'info.cukes:cucumber-java:1.2.5'
    testCompile 'info.cukes:cucumber-junit:1.2.5'
    testCompile 'com.codeborne:selenide:4.8'
    testCompile 'org.apache.maven.plugins:maven-surefire-report-plugin:2.20.1'
    testCompile fileTree(dir: 'libs', include: '*.jar')
    testCompile 'org.apache.commons:commons-pool2:2.4.3'
}

configurations {
    cucumberRuntime {
        extendsFrom testRuntime
    }
}

task setProperties {
    doFirst {
        systemProperties = [
                'file.encoding'   : 'UTF-8',
                'selenide.browser': 'chrome',
                'BUILD_URL'       : System.getenv()['http://svqxqacn7platforma2.pentahoqa.com:8080/pentaho/'],
        ]
    }
}

task cucumber1 {
    dependsOn assemble
    doLast {
        main = "cucumber.api.cli.Main"
        classpath = configurations.cucumberRuntime + sourceSets.test.output
        args = ['--plugin', 'pretty', '--glue', 'features', 'src/test/java']
    }
}

task cucumber2 {
    dependsOn assemble, compileTestJava
    doLast {
        main = "cucumber.api.cli.Main"
        classpath = configurations.cucumberRuntime + sourceSets.test.output
        args = ['-f', 'pretty', '--glue', 'features', 'src/test/java']
    }
}